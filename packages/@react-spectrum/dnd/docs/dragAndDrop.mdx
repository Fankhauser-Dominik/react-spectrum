{/* Copyright 2022 Adobe. All rights reserved.
This file is licensed to you under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License. You may obtain a copy
of the License at http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software distributed under
the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
OF ANY KIND, either express or implied. See the License for the specific language
governing permissions and limitations under the License. */}

import {Layout} from '@react-spectrum/docs';
export default Layout;

import ChevronRight from '@spectrum-icons/workflow/ChevronRight';
import docs from 'docs:@react-spectrum/dnd';
import dndDocs from 'docs:@react-types/shared/src/dnd.d.ts';
import {FunctionAPI, PageDescription, TypeContext, InterfaceType} from '@react-spectrum/docs';
import {Keyboard} from '@react-spectrum/text';

---
category: Concepts
keywords: [drag and drop, dnd]
after_version: 3.0.0
order: 6
---

# Drag and Drop

This page describes how to enable drag and drop functionality for the various React Spectrum components that support it.

## Introduction

Drag and drop is an operation performed when a user "grabs" a UI element via their pointing device and drops it on a different location or element.
It has become a common interaction in many modern applications due to its flexibility across a variety of use cases but can come saddled with
many accessibility issues, including but not limited to keyboard interaction parity and difficulties mimicking drag operations with mouse emulators.
React Spectrum components that support drag and drop operations seek to address these issues by providing full keyboard and screen reader drag and drop
support.

To perform a drag and drop operations via a keyboard, first select the items to be dragged. You can then start the drag operation by focusing the drag handle on any of the
selected rows and hitting <Keyboard>Enter</Keyboard>/<Keyboard>Space</Keyboard>. Once a drag operation is started, <Keyboard>Tab</Keyboard> can be used to cycle through valid
drop targets. Hitting <Keyboard>Enter</Keyboard> will then confirm the drop operation on the focused drop target. For screen readers, please follow the instructions announced
when focusing the row's drag handle to begin a drag operation. Go ahead and try out drag and drop in the example below!


## Drag and Drop Concepts

TODO: add stuff from RFC

## Example

```tsx example
import {Flex} from '@react-spectrum/layout';

<Flex gap="size-300">
  <DraggableList />
  <DroppableList />
</Flex>
```

The example above illustrates how one would use `useDragHooks` and `useDropHooks` to enable dragging files from one ListView to another. For the first ListView, we want to make the rows draggable and
have the dragged rows removed from the list upon a successful drop. To accomplish this, we first want to specify the types of data associated with each item via the array returned by `getItems`. In this case,
we stringify each dragged item's information and map it to the item's type. We also provide a `onDragEnd` event handler to `useDragHooks` that removes the dragged items from the list only
upon a successful drop operation.

```tsx example export=true render=false
import Folder from '@spectrum-icons/workflow/Folder';
import {Item, ListView} from '@react-spectrum/list';
import {Text} from '@adobe/react-spectrum';
import {useDragHooks} from '@react-spectrum/dnd';
import {useListData} from '@react-stately/data';

function DraggableList(props) {
  let {
    items,
    ...otherProps
  } = props;
  let list = useListData({
    initialItems: items || [
      {id: 'a', textValue: 'Adobe Photoshop', type: 'file'},
      {id: 'b', textValue: 'Adobe XD', type: 'file'},
      {id: 'c', textValue: 'Documents', type: 'folder'},
      {id: 'd', textValue: 'Adobe InDesign', type: 'file'},
      {id: 'e', textValue: 'Utilities', type: 'folder'}
    ]
  });

  let dragHooks = useDragHooks({
    getItems: (keys) => [...keys].map(key => {
      let item = list.getItem(key);
      // Setup the info for each item that will be propagated upon drag
      return {
        [item.type]: JSON.stringify(item)
      };
    }),
    onDragEnd: (e) => {
      if (e.dropOperation === 'move') {
        list.remove(...e.keys);
      }
    }
  });

  return (
    <ListView
      aria-label="Draggable list view example"
      width="size-3600"
      height="size-3600"
      selectionMode="multiple"
      items={list.items}
      dragHooks={dragHooks}
      {...otherProps}>
      {item => (
        <Item key={item.key} textValue={item.textValue}>
          {item.type === 'folder' && <Folder />}
          <Text>{item.textValue}</Text>
        </Item>
      )}
    </ListView>
  );
}
```

For the second ListView, we want to make it droppable but have it ignore any drop operations that contains folder items. To implement this filtering, we provide a `getDropOperation` to `useDropHooks` that
returns a "cancel" drop operation if any of the item types includes "folder". Next, we create a `onDrop` event handler to process the successfully dropped items. This `onDrop` handler first checks
each dropped item's kind and type, extracting the item's relevant information if it detects that it is a `file`. This information is used to construct an array of items to add to the list, inserting
them in the list where the user dropped them.

```tsx example export=true render=false
import {useDropHooks} from '@react-spectrum/dnd';

function DroppableList(props) {
  let {
    items,
    ...otherProps
  } = props;
  let list = useListData({
    initialItems: items || [
      {id: 'f', textValue: 'Adobe AfterEffects', type: 'file'},
      {id: 'g', textValue: 'Adobe Illustrator', type: 'file'},
      {id: 'h', textValue: 'Adobe Lightroom', type: 'file'},
      {id: 'i', textValue: 'Adobe Premiere Pro', type: 'file'},
      {id: 'j', textValue: 'Adobe Fresco', type: 'file'}
    ]
  });

  let dropHooks = useDropHooks({
    getDropOperation: (target, types) => {
      if (types.has('folder')) {
        return 'cancel';
      }

      return 'move';
    },
    onDrop: async (e) => {
      let itemsToAdd = [];
      for (let item of e.items) {
        let type, id, textValue;
        if (item.kind === 'text' && item.types.has('file')) {
          let {id, type, textValue} = JSON.parse(await item.getText('file'));
          itemsToAdd.push({
            id,
            type,
            textValue
          });
        }
      }

      if (e.target.type === 'root') {
        list.prepend(...itemsToAdd);
      } else if (e.target.dropPosition === 'before') {
        list.insertBefore(e.target.key, ...itemsToAdd);
      } else {
        list.insertAfter(e.target.key, ...itemsToAdd);
      }
    }
  });

  return (
    <ListView
      aria-label="Droppable list view example"
      width="size-3600"
      height="size-3600"
      selectionMode="multiple"
      items={list.items}
      dropHooks={dropHooks}
      {...otherProps}>
      {item => (
        <Item key={item.key} textValue={item.textValue}>
          {item.type === 'folder' && <Folder />}
          <Text>{item.textValue}</Text>
        </Item>
      )}
    </ListView>
  );
}
```

## API

<FunctionAPI function={docs.exports.useDragHooks} links={docs.links} />
<TypeContext.Provider value={dndDocs.links}>
  <InterfaceType properties={dndDocs.exports.DraggableCollectionProps.properties} />
</TypeContext.Provider>

TODO: add line break here

<FunctionAPI function={docs.exports.useDropHooks} links={docs.links} />
<TypeContext.Provider value={dndDocs.links}>
  <InterfaceType properties={dndDocs.exports.DroppableCollectionProps.properties} />
</TypeContext.Provider>

Enabling drag and drop for a supported React Spectrum component differs slightly from the typical event handler prop pattern that you may be familiar with.
Instead of providing each event handler directly to the component, you must first import `useDragHooks` and `useDropHooks` from `@react-spectrum/dnd` package
and provide those hooks with your desired options.

`useDragHooks` will then provide you with a set of drag hooks that you can pass to the component via its `dragHooks` prop, thus enabling drag operations for the component.
Drop operations can be enabled in the same way by passing the hooks from `useDropHooks` to the component's `dropHooks` prop.

Of the various hook options above, `getAllowedDropOperations` and `getDropOperation` may be of particular interest since it allows you to specify what kinds of drag and drop operations you want to allow.
When the dragged items are dropped on a drop target created using the React Aria drag and drop hooks, the allowed drop operations you return in `getAllowedDropOperations`
are provided to the drop target's `getDropOperation`, giving the drop target extra information which it can use to decide what drop operation to execute. This in turn provides
the `onDragEnd` and `onDrop` handlers with the executed drop operation, allowing you to decide what to do with the dragged items in your original collection and in the dropped collection.

For instance, you may have a draggable collection of items that allows `move` and `copy` operations but you need a way to know whether or not you should be removing the dragged items
from the list after a drop operation. A drop target that only allows `copy` operations, such as a file upload drop zone, would be able to return `copy` from its `getDropOperation` and communicate that
to your draggable collection's `onDragEnd` handler, letting it know that it shouldn't remove the dragged items from the list. Alternatively, a drop target that allows `move` operations, like in the
[example](#example) below, would return `move` from its `getDropOperation` and thus inform your draggable collection to remove the dragged items from it list.

You may be wondering why we didn't simply import the drag and drop hooks within the components themselves. The reason behind this is to reduce the bundle size of
the component for users who don't need the drag and drop support for their component.

The following list shows which components currently support drag and drop:
-  [ListView](ListView.html#drag-and-drop)
